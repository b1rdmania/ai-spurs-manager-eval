# Claude Code Instructions â€” Spurs Manager Evaluation v2

## Project Overview

Data-driven evaluation system for Tottenham Hotspur manager candidates. Built February 2026 after Thomas Frank's dismissal (Spurs 16th, 5 points above relegation).

**Current Status:** 12 managers evaluated using unified scoring model (40% Peer Analysis + 60% Spurs-Fit Model)

**Live Dashboard:** https://b1rdmania.github.io/ai-spurs-manager-eval/

---

## Architecture

### Scoring System

**Final Score = (Peer Ã— 10 Ã— 0.40) + (Spurs-Fit Total Ã— 0.60)**

Where:
- **Peer Score (0-10):** 9 categories with percentile normalization within peer group
- **Spurs-Fit Total (0-100):** 60% Fit Index + 40% Potential Index
  - **Fit Index (0-100):** 4 categories scored 0-25 each using continuous sigmoid curves
  - **Potential Index (0-100):** Age curve (Gaussian peak at 48) + trend + resource leverage + temperament

### Data Flow

```
data/managers.csv (22 KPIs)
data/managers_meta.csv (age, temperament, trend inputs)
        â†“
scripts/pipeline.py orchestrates:
        â†“
1. data_loader.py â†’ validate CSVs
2. peer_score.py â†’ calculate 9 peer categories (0-10 each)
3. fit_index.py â†’ calculate 4 fit categories (0-25 each, sigmoid scoring)
4. potential_index.py â†’ calculate potential (age, trend, leverage, temperament)
5. unified_score.py â†’ compose final score
6. export_json.py â†’ generate docs/data/scores.json
        â†“
docs/index.html + docs/js/*.js
        â†“
GitHub Pages â†’ https://b1rdmania.github.io/ai-spurs-manager-eval/
```

---

## Key Files

### Configuration
- **`config/scoring.yaml`** â€” Single source of truth for all weights, sigmoid parameters, age curve
- **`data/kpi_definitions.yaml`** â€” Documentation of all 22 KPIs

### Data Files
- **`data/managers.csv`** â€” 12 managers Ã— 22 KPIs (PPDA, npxGD/90, Big 6 record, etc.)
- **`data/managers_meta.csv`** â€” Metadata (age, availability, temperament inputs, prev season KPIs)

### Python Scripts
- **`scripts/pipeline.py`** â€” Main orchestrator (run this to regenerate everything)
- **`scripts/peer_score.py`** â€” 9 peer categories with percentile normalization
- **`scripts/fit_index.py`** â€” 4 Spurs-fit categories with sigmoid scoring
- **`scripts/potential_index.py`** â€” Age curve + trend + leverage + temperament
- **`scripts/unified_score.py`** â€” Final score composition
- **`scripts/export_json.py`** â€” Generates JSON for frontend (includes NARRATIVES dict)

### Frontend
- **`docs/index.html`** â€” Single-page dashboard
- **`docs/js/app.js`** â€” Main logic, table rendering, detail sections
- **`docs/js/charts.js`** â€” Chart.js radar/bar chart factories
- **`docs/js/compare.js`** â€” Head-to-head comparison
- **`docs/data/scores.json`** â€” Generated by pipeline, consumed by frontend

### Documentation
- **`README.md`** â€” Project overview, methodology, quick start
- **`docs/enzo-maresca-profile.md`** â€” Detailed Maresca analysis
- **`docs/igor-tudor-profile.md`** â€” Detailed Tudor analysis
- **`docs/maresca-vs-tudor-comparison.md`** â€” Head-to-head comparison

---

## Common Tasks

### Adding a New Manager

1. **Add data row to `data/managers.csv`:**
   ```csv
   Manager Name,ppda,oppda,high_press_regains_90,npxgd_90,...[22 KPIs total]
   ```

2. **Add metadata row to `data/managers_meta.csv`:**
   ```csv
   Manager Name,slug,age,nationality,current_club,available,touchline_bans_3yr,public_disagreements,mid_season_departures,contract_years_remaining,board_backing_score,prev_npxgd_90,prev_ppda,prev_league_pos_pct,squad_value_rank_pct,league_finish_pct
   ```

3. **Add narrative to `scripts/export_json.py` in the `NARRATIVES` dict:**
   ```python
   "manager-slug": {
       "tagline": "The Nickname",
       "summary": "One paragraph bio...",
       "strengths": ["Strength 1", "Strength 2", ...],
       "concerns": ["Concern 1", "Concern 2", ...],
       "verdict": "VERDICT TEXT"
   }
   ```

4. **Run pipeline:**
   ```bash
   python3 -m scripts.pipeline
   ```

5. **Commit and push:**
   ```bash
   git add data/ scripts/export_json.py docs/data/scores.json
   git commit -m "Add [Manager Name]"
   git push origin main
   ```

### Updating Scoring Weights

1. **Edit `config/scoring.yaml`:**
   - Peer category weights (must sum to 1.0)
   - Fit category sigmoid parameters (center, steepness)
   - Potential weights (age, trend, leverage, temperament)
   - Age curve parameters (peak_age, sigma)

2. **Run pipeline:**
   ```bash
   python3 -m scripts.pipeline
   ```

3. **Commit:**
   ```bash
   git add config/scoring.yaml docs/data/scores.json
   git commit -m "Update scoring weights"
   git push
   ```

### Updating Manager Narratives

1. **Edit `scripts/export_json.py`** â€” update the `NARRATIVES` dict
2. **Run pipeline** to regenerate scores.json
3. **Commit and push**

### Testing

```bash
pytest tests/ -v
```

58 tests covering:
- Peer score calculation (percentile normalization, weights)
- Fit index (sigmoid curves, no binary cliffs)
- Potential index (age curve, trend, temperament)
- Unified score composition
- Data validation

---

## Data Collection Guidelines

### Required KPIs (22 total)

**Pressing & Tactical (7):**
1. `ppda` â€” Passes allowed per defensive action (lower = more aggressive)
2. `oppda` â€” Opponent PPDA when facing this manager
3. `high_press_regains_90` â€” High press ball recoveries per 90
4. `npxgd_90` â€” Non-penalty expected goal difference per 90
5. `xg_per_shot` â€” Expected goals per shot (shot quality)
6. `xg_open_play_90` â€” Open play xG per 90
7. `xga_90` â€” Expected goals against per 90

**Big Games (4):**
8. `big6_w` â€” Wins vs top 6 (single season average)
9. `big6_l` â€” Losses vs top 6
10. `big6_d` â€” Draws vs top 6
11. `ko_win_rate` â€” Knockout competition win rate (%)

**Youth Development (3):**
12. `u23_minutes_pct` â€” % of minutes given to U23 players
13. `academy_debuts` â€” Number of academy debuts given
14. `youth_progression_count` â€” Young players progressed to first team

**Squad Management (3):**
15. `injury_days_season` â€” Total injury days across squad
16. `player_availability` â€” % of games players available
17. `squad_rotation_index` â€” Gini coefficient of minutes (0-1)

**Financial (3):**
18. `squad_value_delta_m` â€” Squad value change (millions)
19. `net_spend_m` â€” Net transfer spend (millions)
20. `sell_on_profit_m` â€” Player sale profit (millions)

**Soft Metrics (2):**
21. `fan_sentiment_pct` â€” Fan approval rating (%)
22. `media_vol_sigma` â€” Media coverage volatility (Ïƒ)

### Data Sources

- **FBref** â€” Tactical metrics (PPDA, xG, pressing stats)
- **Transfermarkt** â€” Financial data, squad values, transfers
- **Understat** â€” Expected goals data
- **StatsBomb** â€” Advanced metrics
- **Premier Injuries / Transfermarkt** â€” Injury data
- **Fan polls / social media** â€” Sentiment analysis

### Data Period

Use **most recent club management role** (not national teams). If manager has multiple recent roles, use the most complete/significant one.

Example: Pochettino uses Spurs 2014-2019 (not Chelsea 2023-24 or USA 2024-26) because that's his defining work.

---

## Important Constraints

### Never Use Hard-Coded Rankings
All scores must be **dynamically calculated** from the data. No manual score assignments.

### Sigmoid Scoring (Not Binary)
Fit Index uses **continuous sigmoid curves**, not pass/fail thresholds. A manager scoring PPDA 9.5 gets ~18/25, not 0/25.

### Age Curve is Gaussian
Peak age is **48** (not 35). Curve is wide (sigma 12.0) to avoid penalizing managers 40-56.

### Percentile Normalization
Peer scores use **within-cohort percentiles**. Top performer gets 10, bottom gets 0, others interpolated.

### Multi-Season Data
Big 6 records should be **single-season averages**, not career totals. Example: Pochettino's 23W-37L-25D over 5 years becomes 5W-7L-5D per season.

---

## Deployment

### GitHub Pages
- **Auto-deploys** from `main` branch, serves from `/docs`
- **Cache:** 1-3 minute CDN refresh after push
- **URL:** https://b1rdmania.github.io/ai-spurs-manager-eval/

### Force Cache Refresh
If GitHub Pages shows stale data:
1. Bump version in `docs/data/scores.json`
2. Commit and push
3. Hard refresh browser (Cmd+Shift+R / Ctrl+Shift+R)

---

## Current Managers (12)

1. **Xabi Alonso** (82.6) â€” Real Madrid, unavailable
2. **Mauricio Pochettino** (77.8) â€” USA National Team, unavailable
3. **Andoni Iraola** (68.7) â€” Bournemouth, **top available**
4. **Roberto De Zerbi** (64.1) â€” Free agent
5. **Kieran McKenna** (60.5) â€” Ipswich
6. **Xavi Hernandez** (60.4) â€” Free agent
7. **Marco Silva** (53.7) â€” Fulham
8. **Enzo Maresca** (48.3) â€” Chelsea, unavailable
9. **Igor Tudor** (47.5) â€” Lazio (actual hire in reality)
10. **Robbie Keane** (45.1) â€” Ferencvaros
11. **Oliver Glasner** (34.9) â€” Crystal Palace, unavailable
12. **John Heitinga** (33.1) â€” Tottenham Assistant

---

## Known Issues & Quirks

### Championship Data Limited
For managers like Maresca (Leicester 2023-24), many advanced metrics (PPDA, OPPDA, rotation index) aren't publicly available. Use conservative estimates based on tactical analysis.

### Tudor vs Maresca Controversy
Both hired/rumored in real world but score ~48/100 in model. Both excel in one dimension (Tudor: pressing, Maresca: youth) but fail in the other (Tudor: youth, Maresca: pressing).

### Pochettino Data Correction
Initially used Chelsea 2023-24 data (scored 38.3). Updated to Spurs 2014-2019 data per user request (scored 77.8). This is his defining era and more relevant to Spurs fit.

---

## Contact & Support

Built with [Claude Code](https://claude.com/claude-code) â€” February 2026

**Issues:** https://github.com/b1rdmania/ai-spurs-manager-eval/issues

---

**COYS** ğŸ¤ğŸ’™
